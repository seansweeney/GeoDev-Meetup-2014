<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>One Metadata to Rule Them All</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<style>
			.reveal.has-parallax-background .backgrounds {
				opacity: 0.6;
			}

			.reveal section img {
				background-color: transparent;
				border: none;
				box-shadow: none;
			}

		</style>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section data-background="images/one_ring.png" data-background-size="500px">
					<h1><p>One Metadata to Rule Them All</p></h1>
					<h2><p>NEARC - Groton, CT </p>
						<p>October 7, 2014</p>
					</h2>
					<h3><p>Sean Sweeney, GIS Programmer Analyst</p>
						<p>Rachel Sheketoff, Web Developer</p>
						<p>City of Cambridge, MA</p>
					</h3>
					<aside class="notes">
					  <p>When we recently built our new GIS website, we were searching for a way to better manage our metadata.  At the time we had a data maintenance book in Word documents, plus a separate HTML data dictionary for our old website in addition to the standard SDE metadata.  All of these were carrying similar information but needed to be edited individually.  With the prospect of posting some of our data on GitHub, ArcGIS Online, and our Socrata data portal, we were looking at even more places to edit.</p>

					  <p>In this presentation, we will demo our new data dictionary, which is generated directly from the XML metadata in our ArcSDE database, and we’ll show the process we used to build it.  We’ll also discuss our other ongoing efforts to consolidate our metadata into one single source.</p>
					</aside>
				</section>

				<section>
					<img src='images/sde_metadata.png' alt='SDE' style='position: absolute; top: -40px; left: -40px; margin: 0px; border: none; max-width: none; max-height: none; z-index=10'/>
					<span class='fragment'>
						<img src='images/old_data_dictionary.png' alt='Data Dictionary' style='position: absolute; top: 0px; left: 0px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/old_data_maintenance.png' alt='Data Maintenance' style='position: absolute; top: 40px; left: 40px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<aside class="notes">
					<p>This is a problem I have been thinking about for a couple of years now.  At that time we had our SDE metadata plus our online data dictionary pages and
					our data maintenance pages, which were Word documents.  Three separate things that needed to be maintained separately.</p>
					</aside>
				</section>

				<section>
					<img src='images/sde_metadata.png' alt='SDE' style='position: absolute; top: -40px; left: -40px; margin: 0px; border: none; max-width: none; max-height: none; z-index=10'/>
					<span class='fragment'>
						<img src='images/new_data_dictionary.png' alt='Data Dictionary' style='position: absolute; top: 0px; left: 0px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/new_data_maintenance.png' alt='Data Maintenance' style='position: absolute; top: 40px; left: 40px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/github_data.png' alt='GitHub' style='position: absolute; top: 80px; left: 80px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/arcgis_online.png' alt='ArcGIS Online' style='position: absolute; top: 120px; left: 120px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/arcgis_open_data.png' alt='ArcGIS Open Data' style='position: absolute; top: 160px; left: 160px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/socrata.png' alt='Socrata' style='position: absolute; top: 200px; left: 200px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<aside class="notes">
					<p>In the past year or so, it became even more important as we started to distribute our data in new ways.</p>
					</aside>
				</section>

				<section>
					<img src='images/vision1.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					<span class='fragment'>
						<img src='images/vision2.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					</span>
					<span class='fragment'>
						<img src='images/vision3.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					</span>
					<span class='fragment'>
						<img src='images/vision4.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					</span>
					<span class='fragment'>
						<img src='images/vision5.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					</span>
					<span class='fragment'>
						<img src='images/vision6.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					</span>
					<aside class='notes'>
					<p>The problem is actually a little smaller than that because we removed the redundancy from the Data Maintenance 
					pages and moved those to our internal wiki, AGOD uses AGOL metadata, and Server doesn't really have layer-level 
					metadata anyway.  The point remains, though, that we would prefer to edit the metadata once and distribute it 
					from that central point, like we do for the data itself.</p>
					</aside>
				</section>

				<section>
				<h3>Metadata XML</h3>
					<pre><code data-trim class="xml" style='height:100%'>
<metadata>
    ...
    <descript>
      <abstract>This data set derives from several sources. The...</abstract>
      <purpose>Updated parcel layer with the 2014 land use data.</purpose>
    </descript>					
      ...
      <attr>
        <attrlabl>ML</attrlabl>
        <attrdef>Map-Lot: This a unique parcel identifier found in...</attrdef>
      </attr>
  ...
</metadata>
					</code></pre>
					<aside class='notes'>
					<p>The metadata is stored in the SDE database in XML format.  This is the linchpin of the whole process.  
					All outputs are derived from the XML stored in SDE.</p>
					</aside>
				</section>

				<section>
				<h3>GitHub Export</h3>
				  <pre><code data-trim class="python" style='height:100%'>
installDir = arcpy.GetInstallInfo("desktop")["InstallDir"]
translator = installDir + "Metadata/Translator/ARCGIS2FGDC.xml"

source = database + schema + featureClass
if featureDataset != '':
    source = database + schema + featureDataset + "/" + source

dest = dest_root + "\\" + dest_path + "\\" + dest_name

if not arcpy.Exists(source):
    print "ERROR: " + source + " Not Found"
else:
    arcpy.gp.esri2open_esri2open(source, dest + ".geojson", "Default")
    arcpy.ExportMetadata_conversion(source, translator, dest + ".xml")
	                </code></pre>
					<aside class="notes">
					<p>GitHub was the low hanging fruit - we just export the XML a GP tool and leave it at that.
					</p>
					</aside>
                </section>

				<section>
					<img src='images/github_xml.png' alt='GitHub XML' />
					<aside class="notes"></aside>
				</section>

				<section>
					<p>GitHub - Markdown option? Check Philly.</p>
				</section>

				<section>
					<p>Data Dictionary - show process diagram?</p>
				</section>

				<section>
					<h3>SQL Access to SDE Metadata</h3>
				  <pre><code data-trim class='sql'>
SELECT Documentation
FROM sde.GDB_ITEMS
WHERE PhysicalName LIKE '%.RECREATION_OpenSpace'				  
				  </code></pre>
				</section>

				<section>
					<p>Show configuration table</p>
				</section>

				<section>
					<h3>Sample of XSLT File</h3>
					<pre><code class='xsl' data-trim>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:output method="html" omit-xml-declaration="yes"></xsl:output>
  <xsl:variable name="Upper" select="'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"></xsl:variable>
  <xsl:variable name="Lower" select="'abcdefghijklmnopqrstuvwxyz'"></xsl:variable>
  <xsl:template match="metadata">
    <xsl:if test="count(Binary/Thumbnail/Data) > 0">
      <div class="right">
        <xsl:element name="img">
          <xsl:attribute name="src">data:image/jpeg;base64,<xsl:value-of select="Binary/Thumbnail/Data" /></xsl:attribute>
          <xsl:attribute name="width">350px</xsl:attribute>
        </xsl:element>
      </div>
    </xsl:if>
    ...
    </xsl:template>
    ...
</xsl:stylesheet>
	                </code></pre>
	                <p>Full XSLT: <a target='_blank' href='https://gist.github.com/seansweeney/ae576708d6c651b92c05'>https://gist.github.com/seansweeney/ae576708d6c651b92c05</a></p>
	            </section>

				<section>
					<h3>Transformation in C#</h3>
					<pre><code class='csharp' data-trim>
//do the transformation
XslCompiledTransform xslt = new XslCompiledTransform();
xslt.Load(Settings.GetSetting("GisDataDictionary.XslFileLoc"));
StringWriter sW = new StringWriter();
using (XmlWriter xmlW = XmlWriter.Create(sW, xslt.OutputSettings))
{
       xslt.Transform(xmlR, null, xmlW);
       returnValue = sW.ToString();
}
	                </code></pre>
				</section>

				<section>
					<h3>Data Dictionary</h3>
					<img src='images/new_data_dictionary.png' alt='Data Dictionary' />

					<aside class='notes'><p>Data Dictionary - show page</p></aside>
				</section>

				<section>
					<p>AGOL - show page</p>
				</section>

				<section>
					<p>AGOL - show AGOD page</p>
				</section>

				<section>
					<p>AGOL - show process diagram?</p>
				</section>

				<section>
					<p>AGOL - show REST calls used</p>
				</section>

				<section>
				  <h3>Updating the item</h3>
				  <pre><code data-trim class='python'>
def updateItemDescription(userID, folderID, itemID, portalURL, token=None, snippet, tags):
    '''Update the item descriptive information.'''
    params = {
        'snippet': snippet,
        'tags' : tags,
        'token' : token,
        'f': 'json'
    }
    requestURL = portalURL + '/sharing/rest/content/users/' + userID + '/' + \
                 folderID + '/items/' + itemID + '/update'
    print requestURL
    f = urllib.urlopen(requestURL, urllib.urlencode(params));
    results = f.read();
    print results
    return results
				  </code></pre>
				  <aside class="notes">
				  	This function is used to update the descriptive information for an AGOL item.
				  </aside>
				</section>

				<section>
					<h3>Socrata?</h3>
					<img src='images/socrata_metadata.png' alt='Socrata Metadata' />
				</section>

				<section>
					<h1>More Info</h1>
					<h2>Me</h2>
					<p>Email: ssweeney@cambridgema.gov</p>
					<p>Twitter: @hiker4k</p>
					<p>GitHub: seansweeney</p>
					<p>These Slides: <a target='_blank' href='http://bit.ly/nearc2014sweeney'>http://bit.ly/nearc2014sweeney</a></p>
					<h2>Us</h2>
					<p>Web: <a target='_blank' href='http://cambridgema.gov/gis'>http://cambridgema.gov/gis</a></p>
					<p>Twitter: @CambridgeGIS</p>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: false,
				slideNumber: true,

//				theme: Reveal.getQueryHash().theme || 'default', // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'fade', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				parallaxBackgroundImage: 'images/Map-of-Middle-Earth-lord-of-the-rings-2329809-1600-1200.jpg',
				parallaxBackgroundSize: '1600px 1200px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
